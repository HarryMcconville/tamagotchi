<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <!-- test css for hunger bar -->
    <style>
        .hunger-bar-outer {
            width: 100%;
            height: 20px;
            background-color: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }

        .hunger-bar-inner {
            height: 100%;
            background-color: limegreen;
            transition: width 0.3s ease;
        }
    </style>
    <meta charset="UTF-8">
    <title>Cat Home</title>
    <link rel="stylesheet" href="/style.css">

    <!-- Required bootstrap css import for offcanvas -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="sidebar">
    <div>
        <p th:text="${pet.name} + ' The Cat'"></p>
    </div>
    <div>
        <a href="/play/feed" class="cat-button">Give Food</a>
        <div class="mt-3 text-center">
            <p th:if="${activePet != null}" th:text="'Hunger: ' + ${activePet.hunger} + '%'">Hunger: --%</p>
            <div class="hunger-bar-outer">
                <div class="hunger-bar-inner" th:style="'width:' + ${activePet.hunger} + '%'"></div>
            </div>
        </div>
        <!-- End of hunger bar stuff -->

        <a href="/play/water" class="cat-button">Give Water</a>
        <a href="/play/pet" class="cat-button">Pet</a>
        <a href="/play/game" class="cat-button">Play Game</button></a>
    </div>
    <div>
        <a href="/play/shoo" class="cat-button">Shoo Away</a>
    </div>

    <!-- The off canvas help button config -->
    <div class="mt-3">
        <button class="btn btn-info" type="button" data-bs-toggle="offcanvas" data-bs-target="#helpSidebar" aria-controls="helpSidebar">
            Help
        </button>
    </div>
</div>

<h2 class="alert alert-primary" role="alert" th:text="${flashMessage}" th:if="${flashMessage}"></h2>

<!-- shows the correct cat  -->
<div class="cat-position">
    <a href="#" onclick="playMeowAndRedirect(event)">
        <img th:src="@{'/images/cats/' + ${pet.image}}" alt="Image of Cat" class="cat-image">
    </a>
    <audio id="meow" src="/audio/meow.mp3" preload="auto"></audio>
</div>


<!-- Javascript to play sound before redirect  -->
<script>
    function playMeowAndRedirect(event) {
        event.preventDefault(); // prevent default navigation

        const audio = document.getElementById('meow');
        audio.currentTime = 0;
        audio.play();

        // Redirect after short delay (adjust as needed)
        setTimeout(() => {
            window.location.href = "/play/pet";
        }, 1100);
    }
</script>


<!-- Shows Food bowl and makes clickable -->
<div class="food-bowl-position">
    <a href="/play/feed"><img src="/images/foodbowl.png" class="food-bowl-image"></a>
</div>
<!-- Shows Water bowl and makes clickable -->
<div class="water-bowl-position">
    <a href="/play/water"><img src="/images/waterbowl.png" class="water-bowl-image"></a>
</div>
<!-- Shows Yarn and makes clickable -->
<div class="yarn-position">
    <a href="/play/game"><img src="/images/yarn.png" class="yarn-image"></a>
</div>

<!-- code block for configuring the offcanvas element -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="helpSidebar" aria-labelledby="helpSidebarLabel">
    <div class="offcanvas-header">
        <h5 id="helpSidebarLabel">Help Guide</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <p>Welcome to The Cat Stuff</p>
        <ul>
            <li><strong>Give Food</strong> - Feeds your cat and increases its hunger bar.</li>
            <li><strong>Give Water</strong> - Keeps your cat watered.</li>
            <li><strong>Pet</strong> - Keeps your cat happy... for now..</li>
            <li><strong>Play Game</strong> - Entertains the cat.</li>
            <li><strong>Shoo Away</strong> - They say it's a farm, but I ain't ever see no cats come back out of that forsaken place.</li>
        </ul>
    </div>
</div>

<!-- required js script for offcanvas function -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- TESTING new script for hunger bar -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const bar = document.querySelector(".hunger-bar-inner");
        const hungerText = document.querySelector(".hunger-bar-outer").previousElementSibling;


        let currentHunger = parseInt(bar.style.width) || 0;

        function decreaseHunger() {
            if (currentHunger > 0) {
                currentHunger --;
                bar.style.width = currentHunger + "%";
                hungerText.textContent = "Hunger: " + currentHunger + "%";

            }
        }

        setInterval(decreaseHunger, 10000); // Every 10 seconds
    });
</script>
</body>
</html>
