<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>


    <meta charset="UTF-8">
    <title>Cat Home</title>
    <link rel="stylesheet" href="/style.css">

    <!-- Required bootstrap css import for offcanvas -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="living-room">

<div class="sidebar">
    <div>
        <p th:text="${pet.name} + ' The Cat'"></p>
    </div>
    <div>
<!--        <a href="/play/feed" class="cat-button">Give Food</a>-->
        <div class="mt-3 text-center">
            <p id="hunger-text"
               th:if="${pet != null}"
               th:attr="data-hunger=${pet.hunger}"
               th:text="'Hunger: ' + ${pet.hunger} + '%'">
                Hunger: --%
            </p>
            <div class="hunger-bar-outer">
                <div class="hunger-bar-inner" id="hunger-bar"></div>
            </div>
        </div>
        <!-- End of hunger bar stuff -->

<!--        <a href="/play/water" class="cat-button">Give Water</a>-->
        <!--Water bar stuff-->
        <div class="mt-3 text-center">
            <p id="thirst-text"
               th:if="${pet != null}"
               th:attr="data-thirst=${pet.thirst}"
               th:text="'Thirst: ' + ${pet.thirst} + '%'">
                Thirst: --%
            </p>
            <div class="hunger-bar-outer">
                <div class="hunger-bar-inner" id="thirst-bar"></div>
            </div>
        </div>
        <!-- End of thirst bar stuff -->

<!--        <a href="/play/pet" class="cat-button">Pet</a>-->
        <!--Social bar stuff-->
        <div class="mt-3 text-center">
            <p id="social-text"
               th:if="${pet != null}"
               th:attr="data-social=${pet.social}"
               th:text="'Social: ' + ${pet.social} + '%'">
                Social: --%
            </p>
            <div class="hunger-bar-outer">
                <div class="hunger-bar-inner" id="social-bar"></div>
            </div>
        </div>
        <!-- End of social bar stuff -->
<!--        <a href="/play/game" class="cat-button">Play Game</button></a>-->
        <!--Fun bar stuff-->
        <div class="mt-3 text-center">
            <p id="fun-text"
               th:if="${pet != null}"
               th:attr="data-fun=${pet.fun}"
               th:text="'Fun: ' + ${pet.fun} + '%'">
                Fun: --%
            </p>
            <div class="hunger-bar-outer">
                <div class="hunger-bar-inner" id="fun-bar"></div>
            </div>
        </div>
        <!-- End of Fun bar stuff -->
    </div>
    <!--happiness bar stuff-->
    <div class="mt-3 text-center">
        <p id="happiness-text"
           th:if="${pet != null}"
           th:attr="data-happiness=${pet.happiness}"
           th:text="'Happiness: ' + ${pet.happiness} + '%'">
            Happiness: --%
        </p>
        <div class="hunger-bar-outer">
            <div class="hunger-bar-inner" id="happiness-bar"></div>
        </div>
    </div>
    <!-- End of happiness bar stuff -->
    <div>
        <a href="#" onclick="playMeowAndRedirect(event)" class="cat-button">Shoo Away</a>
        <audio id="meow" src="/audio/meow.mp3" preload="auto"></audio>
    </div>

    <script>
        function playMeowAndRedirect(event) {
            event.preventDefault(); // prevent default navigation

            const audio = document.getElementById('meow');
            audio.currentTime = 0;
            audio.play();

            // Redirect after short delay (adjust as needed)
            setTimeout(() => {
                window.location.href = "/play/confirm_shoo";
            }, 1500);
        }
    </script>

    <!-- The off canvas help button config -->
    <div class="mt-3">
        <button class="btn btn-info" type="button" data-bs-toggle="offcanvas" data-bs-target="#helpSidebar" aria-controls="helpSidebar">
            Help
        </button>
    </div>

    <div>
        <a href="/logout"><button class="btn btn-info" type="button">Logout</button></a>
    </div>

</div>

<h2 class="alert alert-primary" role="alert" th:text="${flashMessage}" th:if="${flashMessage}"></h2>

<!-- shows the correct cat, cuddle button, and thought bubble -->
<div class="cat-position">
    <a href="#" onclick="playPurrAndRedirect(event)">
        <img th:src="@{${pet.happiness} < 60 ? '/images/sadCats/' + ${pet.image} : '/images/cats/' + ${pet.image}}"
             alt="Image of Cat"
             class="cat-image">
    </a>
    <span class="tooltip" th:text="'Cuddle ' + ${pet.name} + '!'"></span>
    <div class="thought-bubble-container">
        <img src="/images/thought-bubble.png" alt="Thought bubble" class="bubble-img">
        <span class="bubble-text" th:text="${statusMessage}"></span>
    </div>
    <audio id="purr" src="/audio/purr.mp3" preload="auto"></audio>
</div>

<!-- Shows Food bowl and makes clickable -->
<div class="food-bowl-position">
    <a href="#" onclick="playFeedAndRedirect(event)"><img src="/images/foodbowl.png" class="food-bowl-image"></a>
    <span class="tooltip" th:text="'Give ' + ${pet.name} + ' some food!'"></span>
    <audio id="feed" src="/audio/feed.mp3" preload="auto"></audio>
</div>

<!-- Shows Water bowl and makes clickable -->
<div class="water-bowl-position">
    <a href="#" onclick="playWaterAndRedirect(event)"><img src="/images/waterbowl.png" class="water-bowl-image"></a>
    <span class="tooltip" th:text="'Give ' + ${pet.name} + ' some water!'"></span>
    <audio id="water" src="/audio/water.mp3" preload="auto"></audio>
</div>

<!-- Shows Yarn and makes clickable -->
<div class="yarn-position">
    <a href="#" onclick="playGameAndRedirect(event)"><img src="/images/yarn.png" class="yarn-image"></a>
    <span class="tooltip" th:text="'Play with ' + ${pet.name} + '!'"></span>
    <audio id="game" src="/audio/game.mp3" preload="auto"></audio>
</div>


<!-- code block for configuring the offcanvas element -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="helpSidebar" aria-labelledby="helpSidebarLabel">
    <div class="offcanvas-header">
        <h5 id="helpSidebarLabel">Help Guide</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <p>Welcome to The Cat Stuff</p>
        <ul>
            <li><strong>Give Food</strong> - Feeds your cat and increases its hunger bar.</li>
            <li><strong>Give Water</strong> - Keeps your cat watered.</li>
            <li><strong>Pet</strong> - Keeps your cat happy... for now..</li>
            <li><strong>Play Game</strong> - Entertains the cat.</li>
            <li><strong>Shoo Away</strong> - They say it's a farm, but I ain't ever see no cats come back out of that forsaken place.</li>
        </ul>
    </div>
</div>

<!-- New Cat Modal -->
<div th:if="${newPetName}" class="modal fade" id="newPetModal" tabindex="-1" aria-labelledby="newPetModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newPetModalLabel">Welcome your new cat!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img th:src="@{'/images/cats/' + ${newPetImage}}" alt="New Cat Image" class="img-fluid mb-3" style="max-height: 200px;"/>
                <p><strong th:text="${newPetName}"></strong> has joined your family!</p>
                <p>
                    <strong>Perk:</strong>
                    <span th:text="${newPetPerk}"></span><br/>
                    <em th:text="${newPetPerkDesc}"></em>
                </p>
                <p>
                    <strong>Flaw:</strong>
                    <span th:text="${newPetFlaw}"></span><br/>
                    <em th:text="${newPetFlawDesc}"></em>
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Awesome!</button>
            </div>
        </div>
    </div>
</div>


<!-- required js script for offcanvas function -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


<script src="/js/play.js"></script>


</body>
</html>
